{% extends 'base.html' %}
{% block title %}Киоск{% endblock %}
{% block body %}
<header class="topbar">
  <div class="brand">
    <div class="logo-circle">
  {% if org_logo %}
    <img src="{{ url_for('uploads', filename=org_logo) }}" alt="Логотип" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">
  {% else %}
    Л
  {% endif %}
</div>
<div class="org">
  <div class="org-title">{{ org_name }}</div>
  <div class="org-sub">Информационный киоск</div>
</div>

    </div>
  </div>
  <div class="spacer"></div>
</header>

<main class="kiosk-main">
  <div class="grid">
    {% for b in buttons %}
    <a class="tile" href="{{ url_for('page', pid=b['page_id']) }}" style="--tile-color: {{ b['color'] or '#0d6efd' }}">
      {% if b['icon_path'] %}
      <img class="tile-icon" src="{{ url_for('uploads', filename=b['icon_path']) }}" alt="icon">
      {% endif %}
      <span class="tile-title">{{ b['title'] }}</span>
    </a>
    {% endfor %}
  </div>
</main>

<footer class="bottombar">
  <div id="datetime"></div>
  <div class="footer-text">
    Для навигации используйте сенсорную панель
  </div>
  <div class="qr-placeholder" id="qrCodeContainer">QR</div>
</footer>

<script>
// Poll theme every 5s
async function pollTheme(){
  try{
    const r = await fetch('/api/theme');
    const j = await r.json();
    const t = j.theme || 'light';
    document.body.classList.toggle('theme-dark', t==='dark');
    document.body.classList.toggle('theme-light', t==='light');
  }catch(e){}
  setTimeout(pollTheme, 5000);
}
pollTheme();
</script>

<!-- Модальное окно PDF -->
<div id="pdfModal" style="display:none; position:fixed; top:5%; left:50%; transform:translateX(-50%); width:80%; height:90%; background:#fff; z-index:1000; border:1px solid #ccc;">
  <button onclick="closePdfModal()" style="float:right;">✖</button>
  <iframe id="pdfFrame" style="width:100%; height:95%;" frameborder="0"></iframe>
</div>

<script>
function openPdfModal(url){
    document.getElementById('pdfFrame').src = url;
    document.getElementById('pdfModal').style.display = 'block';
}
function closePdfModal(){
    document.getElementById('pdfFrame').src = '';
    document.getElementById('pdfModal').style.display = 'none';
}
</script>



<script src="{{ url_for('static', filename='js/qrcode.min.js') }}"></script>
<script>
(async () => {
  try {
    const r = await fetch('/get_qr');
    const { value } = await r.json();
    if (value) {
      const box = document.querySelector('.qr-placeholder');
      box.innerHTML = ''; // очистить "QR"
      new QRCode(box, { text: value, width: 120, height: 120 });
    }
  } catch(e) { console.error(e); }
})();
</script>

<style>
  .bottombar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 5px 15px;
  background: #f8f9fa;
  border-top: 1px solid #ddd;
}

.bottombar .footer-text {
  flex: 1;
  text-align: center;
  font-size: 16px;
  font-weight: 500;
  color: #666; /* серый цвет */
}


</style>

{% endblock %}
